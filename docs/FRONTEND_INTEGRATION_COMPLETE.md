# å‰ç«¯é›†æˆå®Œæˆæ–‡æ¡£

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. API å±‚ (`src/services/noteApi.ts`)

#### æ–°å¢å‡½æ•°

```typescript
/**
 * æ¢å¤å·²åˆ é™¤çš„ç¬”è®°åˆ°"å·²æ¢å¤ç¬”è®°"æ–‡ä»¶å¤¹
 */
export async function restoreNote(id: string): Promise<Note>

/**
 * æ‰¹é‡æ¢å¤å·²åˆ é™¤çš„ç¬”è®°åˆ°"å·²æ¢å¤ç¬”è®°"æ–‡ä»¶å¤¹
 */
export async function restoreNotes(noteIds: string[]): Promise<Note[]>
```

**ç‰¹ç‚¹**ï¼š
- âœ… å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- âœ… è¯¦ç»†çš„ JSDoc æ³¨é‡Šå’Œä½¿ç”¨ç¤ºä¾‹
- âœ… ä¸å…¶ä»– API å‡½æ•°é£æ ¼ä¸€è‡´

---

### 2. Store å±‚ (`src/store/noteStore.ts`)

#### æ–°å¢æ–¹æ³•

```typescript
// æ¥å£å®šä¹‰
restoreNote: (id: string) => Promise<Note>
restoreNotes: (ids: string[]) => Promise<Note[]>

// å®ç°ç»†èŠ‚
- restoreNote: æ¢å¤å•ä¸ªç¬”è®°ï¼Œæ˜¾ç¤ºæˆåŠŸæç¤º
- restoreNotes: æ‰¹é‡æ¢å¤ï¼Œæ˜¾ç¤ºæ¢å¤æ•°é‡æç¤º
- è‡ªåŠ¨æ›´æ–° notes æ•°ç»„
- ä½¿ç”¨ toast æ˜¾ç¤ºæ“ä½œç»“æœ
```

**åŠŸèƒ½**ï¼š
- âœ… è°ƒç”¨ API åè‡ªåŠ¨æ›´æ–°æœ¬åœ°çŠ¶æ€
- âœ… æ¢å¤çš„ç¬”è®°è‡ªåŠ¨æ·»åŠ åˆ° notes åˆ—è¡¨
- âœ… æˆåŠŸ/å¤±è´¥æç¤ºä½¿ç”¨ toast
- âœ… é”™è¯¯å¤„ç†å®Œæ•´

---

### 3. é¡µé¢ç»„ä»¶ (`src/pages/Trash.tsx`)

#### å›æ”¶ç«™é¡µé¢åŠŸèƒ½

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ğŸ“‹ æ˜¾ç¤ºæ‰€æœ‰å·²åˆ é™¤ç¬”è®°ï¼ˆ`is_deleted = true`ï¼‰
- ğŸ”„ æ¢å¤å•ä¸ªç¬”è®°åˆ°"å·²æ¢å¤ç¬”è®°"æ–‡ä»¶å¤¹
- ğŸ”„ æ‰¹é‡æ¢å¤é€‰ä¸­çš„ç¬”è®°
- âœ… å…¨é€‰/å–æ¶ˆå…¨é€‰
- â„¹ï¸ æ˜¾ç¤ºåˆ é™¤æ—¶é—´ï¼ˆ`formatDistanceToNow`ï¼‰
- ğŸ“ æ˜¾ç¤ºç¬”è®°æ‘˜è¦
- ğŸ¨ ç¾è§‚çš„ç©ºçŠ¶æ€æç¤º
- ğŸ“– åº•éƒ¨è¯´æ˜æ–‡æ¡£

**UI ç‰¹æ€§**ï¼š
- ä½¿ç”¨ Tailwind CSS æ ·å¼
- å“åº”å¼å¸ƒå±€
- å›¾æ ‡ä½¿ç”¨ lucide-react
- æš—è‰²æ¨¡å¼æ”¯æŒ
- å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»

**çŠ¶æ€ç®¡ç†**ï¼š
```typescript
const [trashNotes, setTrashNotes] = useState<Note[]>([])
const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set())
const [isLoading, setIsLoading] = useState(true)
const [isRestoring, setIsRestoring] = useState(false)
```

---

### 4. è·¯ç”±é…ç½® (`src/routes.tsx`)

#### æ–°å¢è·¯ç”±

```typescript
import Trash from './pages/Trash'

<Route path="trash" element={<Trash />} />
```

**è·¯å¾„**ï¼š`/trash`

---

### 5. ä¾§è¾¹æ å¯¼èˆª (`src/components/layout/Sidebar.tsx`)

#### æ–°å¢å¯¼èˆªé“¾æ¥

**å›¾æ ‡å¯¼å…¥**ï¼š
```typescript
import { Trash2 } from 'lucide-react'
```

**çŠ¶æ€è·Ÿè¸ª**ï¼š
```typescript
const isTrashPage = currentPath === '/trash'
```

**å¯¼èˆªé“¾æ¥**ï¼š
```tsx
<div
  className={cn(
    "flex items-center gap-2 px-3 py-2 hover:bg-muted/50 cursor-pointer rounded-lg transition-colors text-sm",
    isTrashPage && "bg-accent text-accent-foreground"
  )}
  onClick={() => navigate('/trash')}
>
  <Trash2 className="w-4 h-4 text-red-500" />
  <span className="font-medium">å›æ”¶ç«™</span>
</div>
```

**æ ·å¼**ï¼š
- çº¢è‰²å›¾æ ‡ï¼ˆTrash2ï¼‰
- å½“å‰é¡µé¢é«˜äº®
- Hover æ•ˆæœ

---

## ğŸ¯ ç”¨æˆ·ä½¿ç”¨æµç¨‹

### å•ä¸ªç¬”è®°æ¢å¤

```
1. ç”¨æˆ·ç‚¹å‡»ä¾§è¾¹æ "å›æ”¶ç«™"
   â†“
2. è¿›å…¥ /trash é¡µé¢
   â†“
3. çœ‹åˆ°æ‰€æœ‰å·²åˆ é™¤çš„ç¬”è®°åˆ—è¡¨
   â†“
4. ç‚¹å‡»æŸä¸ªç¬”è®°çš„"æ¢å¤"æŒ‰é’®ï¼ˆâ™»ï¸å›¾æ ‡ï¼‰
   â†“
5. ç¬”è®°ä»åˆ—è¡¨ä¸­æ¶ˆå¤±
   â†“
6. æ˜¾ç¤ºæˆåŠŸæç¤ºï¼š"ç¬”è®°å·²æ¢å¤ï¼Œå·²æ¢å¤åˆ°'å·²æ¢å¤ç¬”è®°'æ–‡ä»¶å¤¹"
   â†“
7. ç”¨æˆ·å¯ä»¥åœ¨æ–‡ä»¶å¤¹æ ‘ä¸­çœ‹åˆ°"å·²æ¢å¤ç¬”è®°"æ–‡ä»¶å¤¹
```

### æ‰¹é‡æ¢å¤

```
1. è¿›å…¥å›æ”¶ç«™é¡µé¢
   â†“
2. å‹¾é€‰è¦æ¢å¤çš„ç¬”è®°ï¼ˆå¤é€‰æ¡†ï¼‰
   â†“
3. ç‚¹å‡»"æ¢å¤é€‰ä¸­ (X)"æŒ‰é’®
   â†“
4. é€‰ä¸­çš„ç¬”è®°å…¨éƒ¨æ¶ˆå¤±
   â†“
5. æ˜¾ç¤ºæç¤ºï¼š"å·²æ¢å¤ X ç¯‡ç¬”è®°ï¼Œå·²æ¢å¤åˆ°'å·²æ¢å¤ç¬”è®°'æ–‡ä»¶å¤¹"
   â†“
6. å¯ä»¥åœ¨"å·²æ¢å¤ç¬”è®°"æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°æ¢å¤çš„ç¬”è®°
```

---

## ğŸ“Š å®Œæ•´çš„æ•°æ®æµ

### åˆ é™¤ â†’ æ¢å¤æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·åˆ é™¤ç¬”è®°] -->|delete_note API| B[åç«¯: is_deleted = 1]
    B --> C[ç¬”è®°ä»æ­£å¸¸åˆ—è¡¨æ¶ˆå¤±]
    C --> D[ç”¨æˆ·æ‰“å¼€å›æ”¶ç«™]
    D -->|list_notes API + è¿‡æ»¤| E[æ˜¾ç¤ºå·²åˆ é™¤ç¬”è®°]
    E -->|restore_note API| F[åç«¯: is_deleted = 0, folder_id = æ¢å¤æ–‡ä»¶å¤¹]
    F --> G[ç¬”è®°ä»å›æ”¶ç«™æ¶ˆå¤±]
    G --> H[ç¬”è®°å‡ºç°åœ¨"å·²æ¢å¤ç¬”è®°"æ–‡ä»¶å¤¹]
    H --> I[ç”¨æˆ·å¯æ‰‹åŠ¨ç§»åŠ¨åˆ°å…¶ä»–æ–‡ä»¶å¤¹]
```

---

## ğŸ¨ UI å±•ç¤º

### ä¾§è¾¹æ å¯¼èˆª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” æœç´¢...  âš™ï¸ â–¼   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ  é¦–é¡µ            â”‚
â”‚ â­ æ”¶è— (5)         â”‚
â”‚ ğŸ—‘ï¸ å›æ”¶ç«™ â† æ–°å¢    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ ç¬”è®°åˆ—è¡¨         â”‚
â”‚  â”œâ”€ ğŸ“ å·¥ä½œ         â”‚
â”‚  â””â”€ ğŸ“„ é¡¹ç›®ç¬”è®°     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å›æ”¶ç«™é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å›æ”¶ç«™                          å…¨é€‰     â”‚
â”‚ å…± 5 ç¯‡å·²åˆ é™¤çš„ç¬”è®°     [æ¢å¤é€‰ä¸­ (2)]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜ ğŸ“„ é¡¹ç›®Aç¬”è®°                            â”‚
â”‚    âš ï¸ åˆ é™¤äº 2 å°æ—¶å‰                     â”‚
â”‚    [æ¢å¤æŒ‰é’® â™»ï¸]                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜‘ ğŸ“„ ä¼šè®®è®°å½•                            â”‚
â”‚    âš ï¸ åˆ é™¤äº 1 å¤©å‰                       â”‚
â”‚    [æ¢å¤æŒ‰é’® â™»ï¸]                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜‘ ğŸ“„ å­¦ä¹ ç¬”è®°                            â”‚
â”‚    âš ï¸ åˆ é™¤äº 3 å¤©å‰                       â”‚
â”‚    [æ¢å¤æŒ‰é’® â™»ï¸]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç©ºçŠ¶æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                            â”‚
â”‚           ğŸ—‘ï¸                              â”‚
â”‚       å›æ”¶ç«™ä¸ºç©º                           â”‚
â”‚                                            â”‚
â”‚  åˆ é™¤çš„ç¬”è®°ä¼šåœ¨è¿™é‡Œä¿ç•™ï¼Œ                   â”‚
â”‚  å¯ä»¥éšæ—¶æ¢å¤åˆ°"å·²æ¢å¤ç¬”è®°"æ–‡ä»¶å¤¹            â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### API è°ƒç”¨

```typescript
// æ¢å¤å•ä¸ªç¬”è®°
const note = await invoke<ApiNote>('restore_note', { id: 'note-id' })

// æ‰¹é‡æ¢å¤
const notes = await invoke<ApiNote[]>('restore_notes', { noteIds: ['id1', 'id2'] })
```

### çŠ¶æ€æ›´æ–°

```typescript
// ä»å›æ”¶ç«™ç§»é™¤
setTrashNotes((prev) => prev.filter((n) => n.id !== id))

// æ·»åŠ åˆ°æ­£å¸¸ç¬”è®°åˆ—è¡¨ï¼ˆnoteStoreï¼‰
set((state) => ({
  notes: [...state.notes, restoredNote],
  activeNoteId: restoredNote.id,
}))
```

### æ—¶é—´æ ¼å¼åŒ–

```typescript
import { formatDistanceToNow } from 'date-fns'
import { zhCN } from 'date-fns/locale'

// æ˜¾ç¤ºï¼š"åˆ é™¤äº 2 å°æ—¶å‰"
formatDistanceToNow(deletedAt, { addSuffix: true, locale: zhCN })
```

---

## ğŸ“ æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ | è¯´æ˜ |
|------|---------|------|
| `src/services/noteApi.ts` | âœï¸ æ–°å¢ | æ·»åŠ  `restoreNote` å’Œ `restoreNotes` å‡½æ•° |
| `src/store/noteStore.ts` | âœï¸ æ–°å¢ | æ·»åŠ æ¢å¤æ–¹æ³•åˆ° store æ¥å£å’Œå®ç° |
| `src/pages/Trash.tsx` | âœ¨ åˆ›å»º | æ–°å»ºå›æ”¶ç«™é¡µé¢ç»„ä»¶ |
| `src/routes.tsx` | âœï¸ ä¿®æ”¹ | æ·»åŠ  `/trash` è·¯ç”± |
| `src/components/layout/Sidebar.tsx` | âœï¸ ä¿®æ”¹ | æ·»åŠ å›æ”¶ç«™å¯¼èˆªé“¾æ¥ |

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•

1. **è®¿é—®å›æ”¶ç«™**
   ```bash
   # ç‚¹å‡»ä¾§è¾¹æ "å›æ”¶ç«™"
   # éªŒè¯ï¼šURL å˜ä¸º /trash
   # éªŒè¯ï¼šæ˜¾ç¤ºå·²åˆ é™¤ç¬”è®°åˆ—è¡¨
   ```

2. **æ¢å¤å•ä¸ªç¬”è®°**
   ```bash
   # ç‚¹å‡»æŸä¸ªç¬”è®°çš„æ¢å¤æŒ‰é’®
   # éªŒè¯ï¼šç¬”è®°ä»åˆ—è¡¨æ¶ˆå¤±
   # éªŒè¯ï¼šæ˜¾ç¤ºæˆåŠŸæç¤º
   # éªŒè¯ï¼šç¬”è®°å‡ºç°åœ¨"å·²æ¢å¤ç¬”è®°"æ–‡ä»¶å¤¹
   ```

3. **æ‰¹é‡æ¢å¤**
   ```bash
   # å‹¾é€‰å¤šä¸ªç¬”è®°
   # ç‚¹å‡»"æ¢å¤é€‰ä¸­"æŒ‰é’®
   # éªŒè¯ï¼šæ‰€æœ‰é€‰ä¸­ç¬”è®°æ¶ˆå¤±
   # éªŒè¯ï¼šæ˜¾ç¤º"å·²æ¢å¤ X ç¯‡ç¬”è®°"
   ```

4. **ç©ºçŠ¶æ€**
   ```bash
   # æ¸…ç©ºæ‰€æœ‰å·²åˆ é™¤ç¬”è®°
   # è®¿é—®å›æ”¶ç«™
   # éªŒè¯ï¼šæ˜¾ç¤ºç©ºçŠ¶æ€æç¤º
   ```

### è¾¹ç•Œæµ‹è¯•

- æ¢å¤ä¸å­˜åœ¨çš„ç¬”è®° â†’ é”™è¯¯æç¤º
- æ¢å¤æ—¶ç½‘ç»œé”™è¯¯ â†’ é”™è¯¯æç¤º
- å›æ”¶ç«™ä¸ºç©ºæ—¶çš„æ˜¾ç¤º
- å·²é€‰ç¬”è®°çš„ UI é«˜äº®

---

## ğŸš€ åç»­å¢å¼ºï¼ˆå¯é€‰ï¼‰

### çŸ­æœŸ

- [ ] æ·»åŠ æ°¸ä¹…åˆ é™¤åŠŸèƒ½ï¼ˆæ¸…ç©ºå›æ”¶ç«™ï¼‰
- [ ] æ·»åŠ "è‡ªåŠ¨æ¸…ç©º"è®¾ç½®ï¼ˆ30å¤©åï¼‰
- [ ] å›æ”¶ç«™ç¬”è®°æ•°é‡è§’æ ‡

### é•¿æœŸ

- [ ] æ¢å¤åˆ°åŸå§‹ä½ç½®ï¼ˆæ–¹æ¡ˆ Aï¼‰
- [ ] å›æ”¶ç«™æœç´¢/è¿‡æ»¤
- [ ] æ‰¹é‡æ“ä½œï¼ˆæ‰¹é‡æ°¸ä¹…åˆ é™¤ï¼‰
- [ ] å›æ”¶ç«™ç»Ÿè®¡ï¼ˆæŒ‰æ—¥æœŸã€æ–‡ä»¶å¤¹åˆ†ç»„ï¼‰

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```tsx
import { useNoteStore } from '@/store/noteStore'

function MyComponent() {
  const { restoreNote, restoreNotes } = useNoteStore()

  // æ¢å¤å•ä¸ªç¬”è®°
  const handleRestore = async () => {
    await restoreNote('note-id')
  }

  // æ‰¹é‡æ¢å¤
  const handleBatchRestore = async () => {
    const ids = ['note-1', 'note-2', 'note-3']
    await restoreNotes(ids)
  }

  return (
    <button onClick={handleRestore}>
      æ¢å¤ç¬”è®°
    </button>
  )
}
```

### ç›´æ¥è°ƒç”¨ API

```tsx
import { restoreNote } from '@/services/noteApi'

async function restore() {
  try {
    const note = await restoreNote('note-id')
    console.log('å·²æ¢å¤:', note)
  } catch (error) {
    console.error('æ¢å¤å¤±è´¥:', error)
  }
}
```

---

## âœ… æ€»ç»“

| å±‚çº§ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| **API å±‚** | âœ… å®Œæˆ | noteApi.ts æ·»åŠ æ¢å¤å‡½æ•° |
| **Store å±‚** | âœ… å®Œæˆ | noteStore æ·»åŠ æ¢å¤æ–¹æ³• |
| **é¡µé¢ç»„ä»¶** | âœ… å®Œæˆ | Trash.tsx å›æ”¶ç«™é¡µé¢ |
| **è·¯ç”±** | âœ… å®Œæˆ | /trash è·¯ç”±é…ç½® |
| **å¯¼èˆª** | âœ… å®Œæˆ | ä¾§è¾¹æ æ·»åŠ å›æ”¶ç«™é“¾æ¥ |
| **UI/UX** | âœ… å®Œæˆ | å®Œæ•´çš„äº¤äº’æµç¨‹ |

**å‰ç«¯é›†æˆå·²å…¨éƒ¨å®Œæˆï¼Œå¯ä»¥ç«‹å³ä½¿ç”¨ï¼** ğŸ‰
